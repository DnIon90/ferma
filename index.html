<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pontaj + Garaj + Cheltuieli</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
h1,h2 { color:#2e7d32; }
input,button { padding:6px; margin:5px 0; border-radius:4px; border:1px solid #ccc; width:100%; max-width:220px; }
button { background:#2e7d32; color:white; border:none; cursor:pointer; }
button:hover { background:#1b5e20; }
section { margin-bottom:25px; background:white; padding:15px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
table { border-collapse: collapse; margin-top:15px; background:white; width:100%; max-width:700px; }
th, td { border:1px solid #ccc; padding:6px 12px; text-align:center; }
th { background:#2e7d32; color:white; }
.total { margin-top:10px; font-weight:bold; }
.muted { font-size:13px; color:#666; }
.delete-btn { background:#d32f2f; color:white; border:none; cursor:pointer; padding:3px 6px; border-radius:3px; font-size:12px; }
.delete-btn:hover { background:#b71c1c; }
</style>
</head>
<body>
<h1>ğŸ“‹ Pontaj + ğŸ§° Garaj + ğŸ’° Cheltuieli</h1>

<!-- LOGIN -->
<section id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br>
    <input id="login-password" placeholder="ParolÄƒ" type="password"><br>
    <button id="login-btn">LogheazÄƒ</button>
    <button id="show-register-btn">ÃnregistreazÄƒ</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br>
      <input id="reg-password" placeholder="ParolÄƒ" type="password"><br>
      <button id="register-btn">CreeazÄƒ cont</button>
      <button id="cancel-register">AnuleazÄƒ</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">DeconecteazÄƒ</button>
  </div>
</section>

<!-- PONTAJ PRINCIPAL -->
<section id="pontaj-area" style="display:none;">
  <h2>ğŸ—ï¸ Pontaj Principal</h2>
  <input type="date" id="work-date">
  <input type="time" id="start-hour" placeholder="Ãnceput">
  <input type="time" id="end-hour" placeholder="SfÃ¢rÈ™it">
  <input type="text" id="work-place" placeholder="Locul de muncÄƒ">
  <input type="number" id="hourly-rate" placeholder="Plata/orÄƒ (â‚¬)">
  <button onclick="addEntry('main')">AdaugÄƒ zi</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>De la</th><th>PÃ¢nÄƒ la</th><th>Ore</th><th>Loc</th><th>â‚¬/orÄƒ</th><th>Total</th><th>È˜terge</th>
      </tr>
    </thead>
    <tbody id="timesheet-table"></tbody>
  </table>
  <div class="total" id="total">Total Plata: 0 â‚¬</div>
</section>

<!-- GARAJ -->
<section id="garaj-area" style="display:none;">
  <h2>ğŸ§° Garaj</h2>
  <input type="date" id="garaj-date">
  <input type="time" id="garaj-start" placeholder="Ãnceput">
  <input type="time" id="garaj-end" placeholder="SfÃ¢rÈ™it">
  <input type="text" id="garaj-desc" placeholder="Activitate (ex: schimb ulei)">
  <input type="number" id="garaj-rate" placeholder="Plata/orÄƒ (â‚¬)">
  <button onclick="addEntry('garaj')">AdaugÄƒ zi Garaj</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>De la</th><th>PÃ¢nÄƒ la</th><th>Ore</th><th>Activitate</th><th>â‚¬/orÄƒ</th><th>Total</th><th>È˜terge</th>
      </tr>
    </thead>
    <tbody id="garaj-table"></tbody>
  </table>
  <div class="total" id="garaj-total">Total Garaj: 0 â‚¬</div>
</section>

<!-- CHELTUIELI -->
<section id="cheltuieli-area" style="display:none;">
  <h2>ğŸ’° Cheltuieli</h2>
  <label>Suma primitÄƒ de la È™ef (â‚¬):</label>
  <input type="number" id="suma-sef" placeholder="Ex: 100">
  <button onclick="adaugaSuma()">AdaugÄƒ / ActualizeazÄƒ</button>
  <hr>
  <input type="number" id="cheltuiala" placeholder="CheltuialÄƒ (â‚¬)">
  <input type="text" id="descriere" placeholder="Descriere (ex: benzinÄƒ)">
  <button onclick="adaugaCheltuiala()">AdaugÄƒ cheltuialÄƒ</button>

  <table>
    <thead>
      <tr><th>#</th><th>Descriere</th><th>Suma</th><th>È˜terge</th></tr>
    </thead>
    <tbody id="tabel-cheltuieli"></tbody>
  </table>
  <div class="total" id="total-cheltuieli">Total cheltuit: 0 â‚¬ | RÄƒmas: 0 â‚¬</div>
</section>

<script>
//=== LOGIN SIMPLE ===
async function sha256Hex(str){const utf8=new TextEncoder().encode(str);const hash=await crypto.subtle.digest('SHA-256',utf8);return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');}
const STORAGE_USERS='timesheet_users';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(u){localStorage.setItem(STORAGE_USERS,JSON.stringify(u));}
let currentUser=null;
let userData={timesheet:[], garaj:[], cheltuieli:[], sumaSef:0};

const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const pontajArea=document.getElementById('pontaj-area');
const garajArea=document.getElementById('garaj-area');
const cheltuieliArea=document.getElementById('cheltuieli-area');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');

showRegBtn.onclick=()=>registerArea.style.display='block';
cancelRegister.onclick=()=>{registerArea.style.display='none';regMsg.textContent='';};
registerBtn.onclick=async()=>{
  const u=regUsername.value.trim(),p=regPassword.value;
  if(!u||!p){regMsg.textContent='CompleteazÄƒ toate cÃ¢mpurile!';return;}
  const users=loadUsers();
  if(users[u]){regMsg.textContent='Username deja folosit!';return;}
  users[u]={passHash:await sha256Hex(p),timesheet:[],garaj:[],cheltuieli:[],sumaSef:0};
  saveUsers(users);regMsg.textContent='Cont creat!';registerArea.style.display='none';
};
loginBtn.onclick=async()=>{
  const u=loginUsername.value.trim(),p=loginPassword.value;
  if(!u||!p){alert("CompleteazÄƒ!");return;}
  const users=loadUsers();
  if(!users[u])return alert("Utilizator inexistent!");
  if(await sha256Hex(p)!==users[u].passHash)return alert("ParolÄƒ greÈ™itÄƒ!");
  currentUser=u;userData=JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser',u);onLogin();
};
logoutBtn.onclick=()=>{currentUser=null;localStorage.removeItem('currentUser');
  notLoggedDiv.style.display='block';loggedDiv.style.display='none';pontajArea.style.display='none';garajArea.style.display='none';cheltuieliArea.style.display='none';};
window.onload=()=>{const saved=localStorage.getItem('currentUser');const users=loadUsers();
  if(saved&&users[saved]){currentUser=saved;userData=users[saved];onLogin();}};

function onLogin(){
  notLoggedDiv.style.display='none';
  loggedDiv.style.display='block';
  pontajArea.style.display='block';
  garajArea.style.display='block';
  cheltuieliArea.style.display='block';
  meUsernameEl.textContent=currentUser;
  renderTables();
}
function saveUser(){const u=loadUsers();u[currentUser]=userData;saveUsers(u);}

//=== PONTAJ & GARAJ ===
function addEntry(type){
  const date=document.getElementById(type==='main'?'work-date':'garaj-date').value;
  const start=document.getElementById(type==='main'?'start-hour':'garaj-start').value;
  const end=document.getElementById(type==='main'?'end-hour':'garaj-end').value;
  const desc=document.getElementById(type==='main'?'work-place':'garaj-desc').value.trim();
  const rate=parseFloat(document.getElementById(type==='main'?'hourly-rate':'garaj-rate').value)||0;
  if(!date||!start||!end||!desc||!rate){alert("CompleteazÄƒ toate cÃ¢mpurile!");return;}
  const diff=(new Date(`${date}T${end}`)-new Date(`${date}T${start}`))/3600000;
  const hours=diff>0?diff:0;const total=(hours*rate).toFixed(2);
  const entry={date,start,end,hours:hours.toFixed(2),desc,rate,total};
  if(type==='main')userData.timesheet.push(entry);else userData.garaj.push(entry);
  saveUser();renderTables();
}
function renderTables(){
  const makeTable=(data,tbodyId,totalId)=>{
    const tbody=document.getElementById(tbodyId);tbody.innerHTML='';let sum=0;
    data.forEach((e,i)=>{const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td><td>${e.date}</td><td>${e.start}</td><td>${e.end}</td><td>${e.hours}</td><td>${e.desc}</td><td>${e.rate}</td><td>${e.total}</td>
      <td><button class='delete-btn' onclick="del('${tbodyId}',${i})">X</button></td>`;
      tbody.appendChild(tr);sum+=parseFloat(e.total);});
    document.getElementById(totalId).textContent=`Total: ${sum.toFixed(2)} â‚¬`;
  };
  makeTable(userData.timesheet,'timesheet-table','total');
  makeTable(userData.garaj,'garaj-table','garaj-total');
  renderCheltuieli();
}
function del(tbody,i){
  if(tbody==='timesheet-table')userData.timesheet.splice(i,1);
  else if(tbody==='garaj-table')userData.garaj.splice(i,1);
  else userData.cheltuieli.splice(i,1);
  saveUser();renderTables();
}

//=== CHELTUIELI ===
function adaugaSuma(){const s=parseFloat(document.getElementById('suma-sef').value)||0;userData.sumaSef+=s;saveUser();renderCheltuieli();}
function adaugaCheltuiala(){
  const s=parseFloat(document.getElementById('cheltuiala').value)||0;const d=document.getElementById('descriere').value.trim();
  if(!s||!d){alert("CompleteazÄƒ!");return;}userData.cheltuieli.push({descriere:d,suma:s});saveUser();renderCheltuieli();
}
function renderCheltuieli(){
  const tbody=document.getElementById('tabel-cheltuieli');tbody.innerHTML='';let total=0;
  userData.cheltuieli.forEach((c,i)=>{const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${c.descriere}</td><td>${c.suma.toFixed(2)}</td><td><button class='delete-btn' onclick="del('tabel-cheltuieli',${i})">X</button></td>`;
    tbody.appendChild(tr);total+=c.suma;});
  const ramas=userData.sumaSef-total;
  document.getElementById('total-cheltuieli').textContent=`Total cheltuit: ${total.toFixed(2)} â‚¬ | RÄƒmas: ${ramas.toFixed(2)} â‚¬`;
}
</script>
</body>
</html>