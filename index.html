<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Foaie Pontaj cu Cheltuieli</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
h1,h2 { color:#2e7d32; }
input,button { padding:6px; margin:5px 0; border-radius:4px; border:1px solid #ccc; width:100%; max-width:220px; }
button { background:#2e7d32; color:white; border:none; cursor:pointer; }
button:hover { background:#1b5e20; }
#login-area,#pontaj-area,#cheltuieli-area { margin-bottom:25px; background:white; padding:15px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
table { border-collapse: collapse; margin-top:15px; background:white; width:100%; max-width:700px; }
th, td { border:1px solid #ccc; padding:6px 12px; text-align:center; }
th { background:#2e7d32; color:white; }
#total, #total-cheltuieli { margin-top:10px; font-weight:bold; }
.muted { font-size:13px; color:#666; }
.edit-btn, .delete-btn { padding:3px 6px; margin:0 2px; border-radius:3px; font-size:12px; }
.edit-btn { background:#ff9800; color:white; border:none; cursor:pointer; }
.edit-btn:hover { background:#f57c00; }
.delete-btn { background:#d32f2f; color:white; border:none; cursor:pointer; }
.delete-btn:hover { background:#b71c1c; }
</style>
</head>
<body>
<h1>ðŸ“… Foaie Pontaj + ðŸ’° Cheltuieli</h1>

<!-- LOGIN -->
<div id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br>
    <input id="login-password" placeholder="ParolÄƒ" type="password"><br>
    <button id="login-btn">LogheazÄƒ</button>
    <button id="show-register-btn">ÃŽnregistreazÄƒ</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br>
      <input id="reg-password" placeholder="ParolÄƒ" type="password"><br>
      <button id="register-btn">CreeazÄƒ cont</button>
      <button id="cancel-register">AnuleazÄƒ</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">DeconecteazÄƒ</button>
  </div>
</div>

<!-- PONTAJ -->
<div id="pontaj-area" style="display:none;">
  <h2>ðŸ•’ Pontaj Zilnic</h2>
  <label>Data:</label>
  <input type="date" id="work-date">
  <label>Ora Ã®nceput:</label>
  <input type="time" id="start-hour">
  <label>Ora final:</label>
  <input type="time" id="end-hour">
  <label>Locul de muncÄƒ / Proiect:</label>
  <input type="text" id="work-place" placeholder="Ex: Birou / Proiect X">
  <label>Plata pe orÄƒ (â‚¬):</label>
  <input type="number" id="hourly-rate" placeholder="Ex: 10" min="0">
  <button onclick="addEntry()">AdaugÄƒ Zi</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>De la</th><th>PÃ¢nÄƒ la</th><th>Ore lucrate</th><th>Locul de muncÄƒ</th><th>Plata/orÄƒ (â‚¬)</th><th>Total (â‚¬)</th><th>AcÈ›iuni</th>
      </tr>
    </thead>
    <tbody id="timesheet-table"></tbody>
  </table>
  <div id="total">Total Plata: 0 â‚¬</div>
</div>

<!-- CHELTUIELI -->
<div id="cheltuieli-area" style="display:none;">
  <h2>ðŸ’° Cheltuieli</h2>
  <label>Suma primitÄƒ de la È™ef (â‚¬):</label>
  <input type="number" id="suma-sef" placeholder="Ex: 100" min="0">
  <button onclick="adaugaSuma()">AdaugÄƒ / ActualizeazÄƒ suma</button>
  <hr>
  <label>CheltuialÄƒ (â‚¬):</label>
  <input type="number" id="cheltuiala" placeholder="Ex: 10" min="0">
  <label>Descriere:</label>
  <input type="text" id="descriere" placeholder="Ex: MÃ¢ncare, benzinÄƒ...">
  <button onclick="adaugaCheltuiala()">AdaugÄƒ cheltuialÄƒ</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Descriere</th><th>Suma (â‚¬)</th><th>AcÈ›iuni</th>
      </tr>
    </thead>
    <tbody id="tabel-cheltuieli"></tbody>
  </table>
  <div id="total-cheltuieli">Total cheltuit: 0 â‚¬ | RÄƒmas: 0 â‚¬</div>
</div>

<script>
async function sha256Hex(str){
  const utf8=new TextEncoder().encode(str);
  const hash=await crypto.subtle.digest('SHA-256',utf8);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

const STORAGE_USERS='timesheet_users';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(u){localStorage.setItem(STORAGE_USERS,JSON.stringify(u));}

const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');
const pontajArea=document.getElementById('pontaj-area');
const cheltuieliArea=document.getElementById('cheltuieli-area');

let currentUser=null;
let userData={timesheet:[], cheltuieli:[], sumaSef:0};

//=== Register / Login ===
showRegBtn.addEventListener('click',()=>{registerArea.style.display='block';});
cancelRegister.addEventListener('click',()=>{registerArea.style.display='none'; regMsg.textContent='';});

registerBtn.addEventListener('click', async () => {
  const u = regUsername.value.trim();
  const p = regPassword.value;
  if(!u||!p){regMsg.textContent='CompleteazÄƒ toate cÃ¢mpurile!'; return;}
  const users = loadUsers();
  if(users[u]){regMsg.textContent='Username deja folosit!'; return;}
  const hash = await sha256Hex(p);
  users[u] = {passHash: hash, timesheet: [], cheltuieli: [], sumaSef: 0};
  saveUsers(users);
  regMsg.textContent='Cont creat! PoÈ›i sÄƒ te loghezi.';
  regUsername.value=''; regPassword.value=''; registerArea.style.display='none';
});

loginBtn.addEventListener('click', async () => {
  const u = loginUsername.value.trim();
  const p = loginPassword.value;
  if(!u||!p){alert('CompleteazÄƒ username È™i parolÄƒ!'); return;}
  const users = loadUsers();
  if(!users[u]){alert('Utilizator inexistent!'); return;}
  const hash = await sha256Hex(p);
  if(hash!==users[u].passHash){alert('ParolÄƒ greÈ™itÄƒ!'); return;}
  currentUser=u;
  userData = JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser', currentUser);
  onLogin();
});

logoutBtn.addEventListener('click',()=>{
  currentUser=null;
  localStorage.removeItem('currentUser');
  notLoggedDiv.style.display='block';
  loggedDiv.style.display='none';
  pontajArea.style.display='none';
  cheltuieliArea.style.display='none';
});

window.onload = () => {
  const savedUser = localStorage.getItem('currentUser');
  const users = loadUsers();
  if(savedUser && users[savedUser]){
    currentUser=savedUser;
    userData = JSON.parse(JSON.stringify(users[savedUser]));
    onLogin();
  }
}

function onLogin(){
  notLoggedDiv.style.display='none';
  loggedDiv.style.display='block';
  pontajArea.style.display='block';
  cheltuieliArea.style.display='block';
  meUsernameEl.textContent=currentUser;
  renderTimesheet();
  renderCheltuieli();
}

//=== Salvare ===
function saveUserData(){
  const users=loadUsers();
  users[currentUser]=userData;
  saveUsers(users);
}

//=== Pontaj ===
function addEntry() {
  const date = document.getElementById('work-date').value;
  const start = document.getElementById('start-hour').value;
  const end = document.getElementById('end-hour').value;
  const place = document.getElementById('work-place').value.trim();
  const rate = parseFloat(document.getElementById('hourly-rate').value)||0;

  if(!date||!start||!end||!place||!rate){alert("CompleteazÄƒ toate cÃ¢mpurile!");return;}

  const diff=(new Date(`${date}T${end}`)-new Date(`${date}T${start}`))/3600000;
  const hours=diff>0?diff:0;
  const total=(hours*rate).toFixed(2);

  const entry={date,start,end,hours:hours.toFixed(2),place,rate,total};
  userData.timesheet.push(entry);
  saveUserData();
  renderTimesheet();

  document.getElementById('work-date').value='';
  document.getElementById('start-hour').value='';
  document.getElementById('end-hour').value='';
  document.getElementById('work-place').value='';
  document.getElementById('hourly-rate').value='';
}

function renderTimesheet(){
  const tbody=document.getElementById('timesheet-table');
  tbody.innerHTML='';
  let totalPayment=0;
  userData.timesheet.forEach((e,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${e.date}</td><td>${e.start}</td><td>${e.end}</td><td>${e.hours}</td><td>${e.place}</td><td>${e.rate}</td><td>${e.total}</td>
    <td><button class="delete-btn" onclick="deleteEntry(${i})">È˜terge</button></td>`;
    tbody.appendChild(tr);
    totalPayment+=parseFloat(e.total);
  });
  document.getElementById('total').textContent=`Total Plata: ${totalPayment.toFixed(2)} â‚¬`;
}

function deleteEntry(i){
  if(confirm("Sigur vrei sÄƒ È™tergi aceastÄƒ zi?")){
    userData.timesheet.splice(i,1);
    saveUserData();
    renderTimesheet();
  }
}

//=== Cheltuieli ===
function adaugaSuma(){
  const suma=parseFloat(document.getElementById('suma-sef').value)||0;
  userData.sumaSef+=suma;
  saveUserData();
  renderCheltuieli();
  document.getElementById('suma-sef').value='';
}

function adaugaCheltuiala(){
  const s=parseFloat(document.getElementById('cheltuiala').value)||0;
  const d=document.getElementById('descriere').value.trim();
  if(!s||!d){alert("CompleteazÄƒ suma È™i descrierea!");return;}
  userData.cheltuieli.push({descriere:d,suma:s});
  saveUserData();
  renderCheltuieli();
  document.getElementById('cheltuiala').value='';
  document.getElementById('descriere').value='';
}

function renderCheltuieli(){
  const tbody=document.getElementById('tabel-cheltuieli');
  tbody.innerHTML='';
  let total=0;
  userData.cheltuieli.forEach((c,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${c.descriere}</td><td>${c.suma.toFixed(2)}</td>
    <td><button class="delete-btn" onclick="stergeCheltuiala(${i})">È˜terge</button></td>`;
    tbody.appendChild(tr);
    total+=parseFloat(c.suma);
  });
  const ramas=userData.sumaSef-total;
  document.getElementById('total-cheltuieli').textContent=`Total cheltuit: ${total.toFixed(2)} â‚¬ | RÄƒmas: ${ramas.toFixed(2)} â‚¬`;
}

function stergeCheltuiala(i){
  if(confirm("È˜tergi aceastÄƒ cheltuialÄƒ?")){
    userData.cheltuieli.splice(i,1);
    saveUserData();
    renderCheltuieli();
  }
}
</script>
</body>
</html>