<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Apartamente + Depozit + Laverie</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
h1,h2 { color:#2e7d32; }
input,button { padding:6px; margin:5px 0; border-radius:4px; border:1px solid #ccc; width:100%; max-width:220px; }
button { background:#2e7d32; color:white; border:none; cursor:pointer; }
button:hover { background:#1b5e20; }
section { margin-bottom:25px; background:white; padding:15px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
table { border-collapse: collapse; margin-top:15px; background:white; width:100%; max-width:700px; }
th, td { border:1px solid #ccc; padding:6px 12px; text-align:center; }
th { background:#2e7d32; color:white; }
.total { margin-top:10px; font-weight:bold; }
.muted { font-size:13px; color:#666; }
.delete-btn { background:#d32f2f; color:white; border:none; cursor:pointer; padding:3px 6px; border-radius:3px; font-size:12px; }
.delete-btn:hover { background:#b71c1c; }
</style>
</head>
<body>
<h1>ğŸ¢ Apartamente + ğŸ­ Depozit + ğŸ§º Laverie</h1>

<!-- LOGIN -->
<section id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br>
    <input id="login-password" placeholder="ParolÄƒ" type="password"><br>
    <button id="login-btn">LogheazÄƒ</button>
    <button id="show-register-btn">ÃnregistreazÄƒ</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br>
      <input id="reg-password" placeholder="ParolÄƒ" type="password"><br>
      <button id="register-btn">CreeazÄƒ cont</button>
      <button id="cancel-register">AnuleazÄƒ</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">DeconecteazÄƒ</button>
  </div>
</section>

<!-- APARTAMENTE -->
<section id="apartamente-area" style="display:none;">
  <h2>ğŸ¢ Apartamente</h2>
  <input type="date" id="work-date">
  <input type="time" id="start-hour" placeholder="Ãnceput">
  <input type="time" id="end-hour" placeholder="SfÃ¢rÈ™it">
  <input type="text" id="work-place" placeholder="Locul de muncÄƒ">
  <input type="number" id="hourly-rate" placeholder="Plata/orÄƒ (â‚¬)">
  <button onclick="addEntry('main')">AdaugÄƒ zi</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>De la</th><th>PÃ¢nÄƒ la</th><th>Ore</th><th>Loc</th><th>â‚¬/orÄƒ</th><th>Total</th><th>È˜terge</th>
      </tr>
    </thead>
    <tbody id="timesheet-table"></tbody>
  </table>
  <div class="total" id="total">Total Apartamente: 0 â‚¬</div>
</section>

<!-- DEPOZIT -->
<section id="depozit-area" style="display:none;">
  <h2>ğŸ­ Depozit</h2>
  <input type="date" id="garaj-date">
  <input type="time" id="garaj-start" placeholder="Ãnceput">
  <input type="time" id="garaj-end" placeholder="SfÃ¢rÈ™it">
  <input type="text" id="garaj-desc" placeholder="Activitate (ex: sortare materiale)">
  <input type="number" id="garaj-rate" placeholder="Plata/orÄƒ (â‚¬)">
  <button onclick="addEntry('garaj')">AdaugÄƒ zi Depozit</button>

  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>De la</th><th>PÃ¢nÄƒ la</th><th>Ore</th><th>Activitate</th><th>â‚¬/orÄƒ</th><th>Total</th><th>È˜terge</th>
      </tr>
    </thead>
    <tbody id="garaj-table"></tbody>
  </table>
  <div class="total" id="garaj-total">Total Depozit: 0 â‚¬</div>
</section>

<!-- LAVERIE -->
<section id="laverie-area" style="display:none;">
  <h2>ğŸ§º Laverie</h2>
  <label>Suma primitÄƒ de la È™ef (â‚¬):</label>
  <input type="number" id="suma-sef" placeholder="Ex: 100">
  <button onclick="adaugaSuma()">AdaugÄƒ / ActualizeazÄƒ</button>
  <hr>
  <input type="number" id="cheltuiala" placeholder="CheltuialÄƒ (â‚¬)">
  <input type="text" id="descriere" placeholder="Descriere (ex: detergent)">
  <button onclick="adaugaCheltuiala()">AdaugÄƒ cheltuialÄƒ</button>

  <table>
    <thead>
      <tr><th>#</th><th>Descriere</th><th>Suma</th><th>È˜terge</th></tr>
    </thead>
    <tbody id="tabel-cheltuieli"></tbody>
  </table>
  <div class="total" id="total-cheltuieli">Total cheltuit: 0 â‚¬ | RÄƒmas: 0 â‚¬</div>
</section>

<script>
// SHA-256
async function sha256Hex(str){
  const utf8=new TextEncoder().encode(str);
  const hash=await crypto.subtle.digest('SHA-256',utf8);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// Storage
const STORAGE_USERS='timesheet_users';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(users){localStorage.setItem(STORAGE_USERS,JSON.stringify(users));}

// Elemente
const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');

const apartamenteArea=document.getElementById('apartamente-area');
const depozitArea=document.getElementById('depozit-area');
const laverieArea=document.getElementById('laverie-area');

let currentUser=null;
let userData={timesheet:[], garaj:[], cheltuieli:[], sumaSef:0};

// Register / Login
showRegBtn.onclick=()=>registerArea.style.display='block';
cancelRegister.onclick=()=>{registerArea.style.display='none'; regMsg.textContent='';};

registerBtn.onclick=async()=>{
  const u=regUsername.value.trim();
  const p=regPassword.value;
  if(!u||!p){regMsg.textContent='CompleteazÄƒ toate cÃ¢mpurile!'; return;}
  const users=loadUsers();
  if(users[u]){regMsg.textContent='Username deja folosit!'; return;}
  const hash=await sha256Hex(p);
  users[u]={passHash:hash, timesheet:[], garaj:[], cheltuieli:[], sumaSef:0};
  saveUsers(users);
  regMsg.textContent='Cont creat! PoÈ›i sÄƒ te loghezi.';
  registerArea.style.display='none';
  regUsername.value=''; regPassword.value='';
};

loginBtn.onclick=async()=>{
  const u=loginUsername.value.trim();
  const p=loginPassword.value;
  if(!u||!p){alert("CompleteazÄƒ username È™i parolÄƒ!"); return;}
  const users=loadUsers();
  if(!users[u]){alert("Utilizator inexistent!"); return;}
  const hash=await sha256Hex(p);
  if(hash!==users[u].passHash){alert("ParolÄƒ greÈ™itÄƒ!"); return;}
  currentUser=u;
  userData=JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser', currentUser);
  onLogin();
  loginUsername.value=''; loginPassword.value='';
};

logoutBtn.onclick=()=>{
  currentUser=null;
  localStorage.removeItem('currentUser');
  notLoggedDiv.style.display='block';
  loggedDiv.style.display='none';
  apartamenteArea.style.display='none';
  depozitArea.style.display='none';
  laverieArea.style.display='none';
};

// On load
window.onload=()=>{
  const savedUser=localStorage.getItem('currentUser');
  const users=loadUsers();
  if(savedUser && users[savedUser]){
    currentUser=savedUser;
    userData=users[savedUser];
    onLogin();
  }
};

function onLogin(){
  notLoggedDiv.style.display='none';
  loggedDiv.style.display='block';
  apartamenteArea.style.display='block';
  depozitArea.style.display='block';
  laverieArea.style.display='block';
  meUsernameEl.textContent=currentUser;
  renderTables();
}

// SalveazÄƒ date
function saveUser(){const users=loadUsers(); users[currentUser]=userData; saveUsers(users);}